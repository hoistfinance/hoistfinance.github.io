If(IsBooking,
    UpdateContext({ShowLoading: true});
        If(!BookForMeeting,
            Office365.V2CalendarPostItem(MyCalendar, "Workspace", StartDateTimeUTC, EndDateTimeUTC, 
            {RequiredAttendees:'SelectBookingScreen>ResouceGallery'.Selected.Email, Location: 'SelectBookingScreen>ResouceGallery'.Selected.Name, Importance: "Normal", ShowAs: "Free"}),
            
            ClearCollect(RequiredAttendeesNoRoom, Split('ManageBookingsScreen>MeetingsGallery'.Selected.RequiredAttendees, ";"));
            ForAll(AllRooms, RemoveIf(RequiredAttendeesNoRoom, Address = Result));
            ClearCollect(RequiredAttendeesNoRoom, Concat(RequiredAttendeesNoRoom, Result & ";"));
            ClearCollect(RequiredAttendeesNoRoom, Split(First(RequiredAttendeesNoRoom).Value, ";;"));
            Set(RequiredAttendeesFinal, First(RequiredAttendeesNoRoom).Result);
            Set(RequiredAttendeesTrue, 'SelectBookingScreen>ResouceGallery'.Selected.Email & ";" & RequiredAttendeesFinal);
            Office365.V2CalendarPatchItem(MyCalendar, 'ManageBookingsScreen>MeetingsGallery'.Selected.Id, If('ManageBookingsScreen>MeetingsGallery'.Selected.Subject = "Workspace: " & User().FullName & "'s Skype Meeting", "Workspace", 'ManageBookingsScreen>MeetingsGallery'.Selected.Subject), StartDateTimeUTC, EndDateTimeUTC, {RequiredAttendees: RequiredAttendeesTrue, OptionalAttendees: 'ManageBookingsScreen>MeetingsGallery'.Selected.OptionalAttendees, Body: "Room has been updated to " & 'SelectBookingScreen>ResouceGallery'.Selected.Name, Location: 'SelectBookingScreen>ResouceGallery'.Selected.Name, Importance: "Normal", ShowAs: "Free"})
            );

    UpdateContext({ShowLoading: false})
);
Set(IsBooking, false)
